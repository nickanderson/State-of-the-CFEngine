<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>State of the CFEngine</title>
<meta name="author" content="Nick Anderson"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="file:///home/nickanderson/src/reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="file:///home/nickanderson/src/reveal.js/css/theme/white.css" id="theme"/>

<link rel="stylesheet" href="./modifications.css"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'file:///home/nickanderson/src/reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<meta name=description" content=Or Since last time at config management camp ...">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-background="./orange-blue-tilt-right.png">
<h1 class="title">State of the CFEngine</h1><h2 class="author">Nick Anderson</h2>
</section>

<section>
<section id="slide-org28dce07" data-background="./2018-01-14_Selection_005.png">
<h2 id="org28dce07"></h2>

</section>
</section>
<section>
<section id="slide-org8ff1104" data-background="./data/b5/0764c2-dbb0-4499-87af-3d8b90b3e8d5/2020-02-03_05-35-14_nicks-bionic-back.png">
<h2 id="org8ff1104"><font color="orange">Happy to be back</font></h2>

</section>
</section>
<section>
<section id="slide-orgf3651a3">
<h2 id="orgf3651a3">Releases since 2018-02-05</h2>
<p>
15 releases!
</p>

<p>

</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Version</th>
<th scope="col" class="org-right">Date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">3.10.4</td>
<td class="org-right">2018-05-03</td>
</tr>

<tr>
<td class="org-right">3.7.8</td>
<td class="org-right">2018-05-03</td>
</tr>

<tr>
<td class="org-right">3.12.0</td>
<td class="org-right">2018-06-28</td>
</tr>

<tr>
<td class="org-right">3.10.5</td>
<td class="org-right">2018-11-16</td>
</tr>

<tr>
<td class="org-right">3.13.0</td>
<td class="org-right">2018-11-23</td>
</tr>

<tr>
<td class="org-right">3.12.1</td>
<td class="org-right">2018-11-30</td>
</tr>

<tr>
<td class="org-right">3.10.6</td>
<td class="org-right">2019-05-10</td>
</tr>

<tr>
<td class="org-right">3.12.2</td>
<td class="org-right">2019-05-20</td>
</tr>

<tr>
<td class="org-right">3.12.2-2</td>
<td class="org-right">2019-05-29</td>
</tr>

<tr>
<td class="org-right">3.14.0</td>
<td class="org-right">2019-07-01</td>
</tr>

<tr>
<td class="org-right">3.12.2-3</td>
<td class="org-right">2019-07-25</td>
</tr>

<tr>
<td class="org-right">3.14.0-2</td>
<td class="org-right">2019-07-29</td>
</tr>

<tr>
<td class="org-right">3.12.3</td>
<td class="org-right">2019-12-11</td>
</tr>

<tr>
<td class="org-right">3.10.7</td>
<td class="org-right">2019-12-11</td>
</tr>

<tr>
<td class="org-right">3.15.0</td>
<td class="org-right">2019-12-19</td>
</tr>
</tbody>
</table>

</section>
<section id="slide-org8fe053a">
<h3 id="org8fe053a">2 LTS series reached End of Life</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Version</th>
<th scope="col" class="org-right">Date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">3.7.8</td>
<td class="org-right">2018-05-03</td>
</tr>

<tr>
<td class="org-right">3.10.7</td>
<td class="org-right">2019-12-11</td>
</tr>
</tbody>
</table>


<div class="figure">
<p><img src="data/73/c1edf0-7bfc-42a5-9df8-d3097ad85f6f/2020-01-16_14-32-30_wallpaper-1d7b28.jpg" alt="2020-01-16_14-32-30_wallpaper-1d7b28.jpg" />
</p>
</div>

</section>
<section id="slide-org2e36db0">
<h3 id="org2e36db0">2 LTS series born</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Version</th>
<th scope="col" class="org-right">Date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">3.12.0</td>
<td class="org-right">2018-06-28</td>
</tr>

<tr>
<td class="org-right">3.15.0</td>
<td class="org-right">2019-12-19</td>
</tr>
</tbody>
</table>


<div class="figure">
<p><img src="data/5e/7bdcfc-e94e-41e3-8245-836238b07399/2020-01-16_14-45-47_450.png" alt="2020-01-16_14-45-47_450.png" />
</p>
</div>

</section>
</section>
<section>
<section id="slide-orgc3bcd0c">
<h2 id="orgc3bcd0c">Contributions</h2>
<div class="outline-text-2" id="text-orgc3bcd0c">
</div>
</section>
<section id="slide-org40cd40f">
<h3 id="org40cd40f">2017</h3>
<table id="org8121a75" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">Core</td>
<td class="org-right">MPF</td>
<td class="org-right">Docs</td>
</tr>

<tr>
<td class="org-left">Commits</td>
<td class="org-right">244</td>
<td class="org-right">154</td>
<td class="org-right">186</td>
</tr>

<tr>
<td class="org-left">Contributors</td>
<td class="org-right">23</td>
<td class="org-right">13</td>
<td class="org-right">17</td>
</tr>

<tr>
<td class="org-left">New Contributors</td>
<td class="org-right">9</td>
<td class="org-right">3</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>
</section>
<section id="slide-orga584f40">
<h3 id="orga584f40">2018</h3>
<table id="org441c763" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">Core</td>
<td class="org-right">MPF</td>
<td class="org-right">Docs</td>
</tr>

<tr>
<td class="org-left">Commits</td>
<td class="org-right">492</td>
<td class="org-right">163</td>
<td class="org-right">231</td>
</tr>

<tr>
<td class="org-left">Contributors</td>
<td class="org-right">18</td>
<td class="org-right">22</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">New Contributors</td>
<td class="org-right">7</td>
<td class="org-right">9</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>

</section>
<section id="slide-orgc946bd0">
<h3 id="orgc946bd0">2019</h3>
<table id="org2a295e9" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-right">Core</td>
<td class="org-right">MPF</td>
<td class="org-right">Docs</td>
</tr>

<tr>
<td class="org-left">Commits</td>
<td class="org-right">612</td>
<td class="org-right">255</td>
<td class="org-right">172</td>
</tr>

<tr>
<td class="org-left">Contributors</td>
<td class="org-right">22</td>
<td class="org-right">20</td>
<td class="org-right">15</td>
</tr>

<tr>
<td class="org-left">New Contributors</td>
<td class="org-right">9</td>
<td class="org-right">8</td>
<td class="org-right">3</td>
</tr>
</tbody>
</table>

</section>
</section>
<section>
<section id="slide-orgcbd0c50">
<h2 id="orgcbd0c50">Core</h2>
<div class="outline-text-2" id="text-orgcbd0c50">
</div>
</section>
<section id="slide-org9d4a75b">
<h3 id="org9d4a75b"><code>basename()</code></h3>
<ul>
<li>New in 3.15.0</li>
<li>Convenient and familiar</li>

</ul>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">example_basename</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">vars</span>:
      <span style="color: #2d9574;">"basename"</span> -&gt; <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">"CFE-3196"</span> <span style="color: #bc6ec5;">}</span>
        <span style="color: #ce537a; font-weight: bold;">string</span> =&gt; basename<span style="color: #bc6ec5;">(</span> $<span style="color: #2d9574;">(</span><span style="color: #7590db;">this.promise_filename</span><span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">)</span>;

      <span style="color: #2d9574;">"basename_wo_extension"</span> -&gt; <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">"CFE-3196"</span> <span style="color: #bc6ec5;">}</span>
        <span style="color: #ce537a; font-weight: bold;">string</span> =&gt; basename<span style="color: #bc6ec5;">(</span> $<span style="color: #2d9574;">(</span><span style="color: #7590db;">this.promise_filename</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">".cf"</span> <span style="color: #bc6ec5;">)</span>;
  <span style="color: #4f97d7;">reports</span>:

      <span style="color: #2d9574;">"basename = '$(basename)'"</span>;
      <span style="color: #2d9574;">"basename without '.cf' extension = '$(basename_wo_extension)'"</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
# cf-agent --bundlesequence example_basename --no-lock --log-level info --file /home/nickanderson/src/presentations/state-of-the-cfengine/cfengine3-NiK6sU
    info: Using command line specified bundlesequence
R: basename = 'cfengine3-NiK6sU'
R: basename without '.cf' extension = 'cfengine3-NiK6sU'
</pre>

</section>
<section id="slide-org97d4562">
<h3 id="org97d4562"><code>classfiltercsv()</code></h3>
<ul>
<li>New in 3.15.0</li>
<li>Useful to reduce logic and speed policy</li>

</ul>
</section>
<section id="slide-org94faa54">
<h4 id="org94faa54"><code>classfiltercsv()</code> Input</h4>
<div class="org-src-container">

<pre  class="src src-csv">ClassExpr<span style="color: #00ffff;">,</span>Sort<span style="color: #00ffff;">,</span>Token<span style="color: #00ffff;">,</span>Value
<span style="color: #2aa1ae; background-color: #292e34;"># This is a comment</span>
any<span style="color: #00ffff;">,</span>A<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>ANYVALUE
example_class1<span style="color: #00ffff;">,</span>z<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>ANYVALUE
example_class2<span style="color: #00ffff;">,</span>a<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>127.0.0.3
not_defined<span style="color: #00ffff;">,</span>Z<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>NOT_DEFINED
example_class3.example_class2.example_class1<span style="color: #00ffff;">,</span>1<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>127.0.0.4
also_undefined<span style="color: #00ffff;">,</span>0<span style="color: #00ffff;">,</span>net.ipv4.ip_forward<span style="color: #00ffff;">,</span>NOT_DEFINED
</pre>
</div>

<ul>
<li><b>NOTE:</b> CRLF (Windows/DOS)  line endings required per RFC</li>

</ul>

</section>
<section id="slide-orgc807caa">
<h4 id="orgc807caa"><code>classfiltercsv()</code> Example Policy</h4>
<div class="org-src-container">

<pre  class="src src-cfengine3" id="example_classfiltercsv"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">example_classfiltercsv</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">classes</span>:
      <span style="color: #2d9574;">"example_class1"</span>;
      <span style="color: #2d9574;">"example_class2"</span>;
      <span style="color: #2d9574;">"example_class3"</span>;

  <span style="color: #4f97d7;">vars</span>:
      <span style="color: #2d9574;">"data_file"</span> <span style="color: #ce537a; font-weight: bold;">string</span> =&gt; <span style="color: #2d9574;">"$(this.promise_dirname)/data/classfiltercsv.csv"</span>;
      <span style="color: #2d9574;">"d"</span> <span style="color: #ce537a; font-weight: bold;">data</span> =&gt; classfiltercsv<span style="color: #bc6ec5;">(</span>$<span style="color: #2d9574;">(</span><span style="color: #7590db;">data_file</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">"true"</span>, <span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">1</span><span style="color: #bc6ec5;">)</span>;

  <span style="color: #4f97d7;">reports</span>:
      <span style="color: #2d9574;">"Filtered data: $(with)"</span> with =&gt; string_mustache<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"{{%-top-}}"</span>, d<span style="color: #bc6ec5;">)</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-org0fccbc7">
<h4 id="org0fccbc7"><code>classfiltercsv()</code> Policy Output</h4>
<pre class="example">
R: Filtered data: [
  {
    "Sort": "A",
    "Token": "net.ipv4.ip_forward",
    "Value": "ANYVALUE"
  },
  {
    "Sort": "a",
    "Token": "net.ipv4.ip_forward",
    "Value": "127.0.0.3"
  },
  {
    "Sort": "z",
    "Token": "net.ipv4.ip_forward",
    "Value": "127.0.0.4"
  },
  {
    "Sort": "z",
    "Token": "net.ipv4.ip_forward",
    "Value": "ANYVALUE"
  }
]
</pre>

</section>
<section id="slide-orgfd73e42">
<h4 id="orgfd73e42"><code>classfiltercsv()</code> For more&#x2026;</h4>
<p>
Checkout Jay Goldberg's talk "Data-Driven Configuration with CFEngine's classfiltercsv function" tomorrow, 16:50–17:15, B.2.009
</p>
</section>
<section id="slide-org7459d95">
<h3 id="org7459d95"><code>hash_to_int()</code></h3>
<ul>
<li>New in 3.12.0</li>
<li>Useful for distributed grouping and orchestration (re-implement select_class)</li>

</ul>

<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">example_hash_to_int</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">vars</span>:
      <span style="color: #2d9574;">"hello"</span>  <span style="color: #ce537a; font-weight: bold;">int</span> =&gt; hash_to_int<span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">1000</span>, <span style="color: #2d9574;">"hello"</span><span style="color: #bc6ec5;">)</span>;
      <span style="color: #2d9574;">"world"</span>  <span style="color: #ce537a; font-weight: bold;">int</span> =&gt; hash_to_int<span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">1000</span>, <span style="color: #2d9574;">"world"</span><span style="color: #bc6ec5;">)</span>;

      <span style="color: #2aa1ae; background-color: #292e34;"># Hash can vary on hostkey or policy hub:</span>
      <span style="color: #2d9574;">"hour"</span>   <span style="color: #ce537a; font-weight: bold;">int</span> =&gt; hash_to_int<span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">24</span>, <span style="color: #2d9574;">"$(sys.key_digest)"</span><span style="color: #bc6ec5;">)</span>;
      <span style="color: #2d9574;">"minute"</span> <span style="color: #ce537a; font-weight: bold;">int</span> =&gt; hash_to_int<span style="color: #bc6ec5;">(</span><span style="color: #a45bad;">0</span>, <span style="color: #a45bad;">60</span>, <span style="color: #2d9574;">"$(sys.policy_hub)"</span><span style="color: #bc6ec5;">)</span>;

  <span style="color: #4f97d7;">reports</span>:
      <span style="color: #2d9574;">"'hello' hashed to: $(hello)"</span>;
      <span style="color: #2d9574;">"'world' hashed to: $(world)"</span>;

<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
    info: Using command line specified bundlesequence
R: 'hello' hashed to: 172
R: 'world' hashed to: 760
</pre>

</section>
<section id="slide-org3ce35ef">
<h3 id="org3ce35ef"><code>string_replace()</code></h3>
<ul>
<li>New in 3.12.1</li>
<li>Convenience, more simple version of <code>regex_replace()</code></li>

</ul>

<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">example_string_replace</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">vars</span>:
      <span style="color: #2d9574;">"my_string"</span> <span style="color: #ce537a; font-weight: bold;">string</span> =&gt; <span style="color: #2d9574;">"This is not the string you are looking for"</span>;

  <span style="color: #4f97d7;">reports</span>:
      <span style="color: #2d9574;">"$(with)"</span> with =&gt; string_replace<span style="color: #bc6ec5;">(</span> $<span style="color: #2d9574;">(</span><span style="color: #7590db;">my_string</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">"not "</span>, <span style="color: #2d9574;">""</span> <span style="color: #bc6ec5;">)</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
R: This is the string you are looking for
</pre>

</section>
<section id="slide-orgf6ec87c">
<h3 id="orgf6ec87c"><code>read_module_protocol()</code></h3>
<ul>
<li>New in 3.15.0</li>
<li>Useful for leveraging cached output from module protocol</li>
<li>More light weight and less noisy than using <code>cat</code></li>

</ul>
</section>
<section id="slide-org2cb61f1">
<h4 id="org2cb61f1"><code>read_module_protocol()</code> Example usage</h4>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">cache_maintenance</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Creates a module protocol cache, refreshes it if minute is 30-35</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">vars</span>:
      <span style="color: #2d9574;">"file"</span>
        <span style="color: #ce537a; font-weight: bold;">string</span> =&gt; <span style="color: #2d9574;">"$(this.promise_dirname)/cached_module"</span>;

  <span style="color: #4f97d7;">classes</span>:
      <span style="color: #2d9574;">"cache_refresh"</span>
        if =&gt; not<span style="color: #bc6ec5;">(</span>fileexists<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"$(file)"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>;
    <span style="color: #4f97d7; font-weight: bold;">Min30_35</span>::
      <span style="color: #2d9574;">"cache_refresh"</span>;

  <span style="color: #4f97d7;">files</span>:
    <span style="color: #4f97d7; font-weight: bold;">cache_refresh</span>::
      <span style="color: #2d9574;">"$(file)"</span>
        create =&gt; <span style="color: #2d9574;">"true"</span>,
        template_method =&gt; <span style="color: #2d9574;">"inline_mustache"</span>,
        edit_template_string =&gt; <span style="color: #2d9574;">"=my_variable=$(sys.date)"</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-org71916af">
<h4 id="org71916af"><code>read_module_protocol()</code> Example usage continued &#x2026;</h4>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">demo</span>
<span style="color: #2aa1ae; background-color: #292e34;"># </span><span style="color: #2aa1ae; background-color: #292e34;">Demonstrates read_module_protocol function, prints a variable from it</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">classes</span>:
      <span style="color: #2d9574;">"cache_was_read"</span>
        if =&gt; read_module_protocol<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"$(cache_maintenance.file)"</span><span style="color: #bc6ec5;">)</span>;

  <span style="color: #4f97d7;">reports</span>:
    <span style="color: #4f97d7; font-weight: bold;">cache_was_read</span>::
      <span style="color: #2d9574;">"Module cache was read!"</span>;
      <span style="color: #2d9574;">"cached_module.my_variable = $(cached_module.my_variable)"</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">__main__</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">methods</span>:
      <span style="color: #2d9574;">"cache_maintenance"</span>
        handle =&gt; <span style="color: #2d9574;">"cache_maintenance_done"</span>;
      <span style="color: #2d9574;">"demo"</span>
        depends_on =&gt; <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">"cache_maintenance_done"</span> <span style="color: #bc6ec5;">}</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
R: Module cache was read!
R: cached_module.my_variable = Mon Feb  3 05:32:05 2020
</pre>

</section>
<section id="slide-org57a2104">
<h4 id="org57a2104"><code>read_module_protocol()</code> Example output</h4>
<pre class="example">
R: Module cache was read!
R: cached_module.my_variable = Mon Feb  3 05:32:05 2020
</pre>

</section>
<section id="slide-org88de64d">
<h3 id="org88de64d"><code>body copy_from missing_ok</code></h3>
<ul>
<li>New in 3.12.0</li>
<li>Promise KEPT if source file is missing (except for remote</li>
<li>Useful for opportunistic copies (host specific data)</li>

</ul>

</section>
<section id="slide-org021cbb2">
<h4 id="org021cbb2"><code>body copy_from missing_ok</code> Example</h4>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">files</span>:
      <span style="color: #2d9574;">"/tmp/my.file"</span>
        copy_from =&gt; local_if_available<span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">"/tmp/$(sys.fqhost).json"</span> <span style="color: #bc6ec5;">)</span>,
        classes =&gt; results<span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">"bundle"</span>, <span style="color: #2d9574;">"copy_from_local"</span> <span style="color: #bc6ec5;">)</span>;

      <span style="color: #2d9574;">"/tmp/my.file"</span>
        copy_from =&gt; server_if_available<span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">"/tmp/$(sys.fqhost).json"</span> <span style="color: #bc6ec5;">)</span>,
        classes =&gt; results<span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">"bundle"</span>, <span style="color: #2d9574;">"copy_from_server"</span> <span style="color: #bc6ec5;">)</span>;

  <span style="color: #4f97d7;">reports</span>:
      <span style="color: #2d9574;">"$(with)"</span>
        with =&gt; string_mustache<span style="color: #bc6ec5;">(</span> <span style="color: #2d9574;">"Classes:$(const.n){{#-top-}}{{.}}$(const.n){{/-top-}}"</span>,
                                 sort<span style="color: #2d9574;">(</span> classesmatching<span style="color: #67b11d;">(</span> <span style="color: #2d9574;">"copy_from_.*"</span> <span style="color: #67b11d;">)</span>, lex<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #4f97d7;">body</span> <span style="color: #a45bad;">copy_from</span> <span style="color: #bc6ec5; font-weight: bold;">local_if_available</span><span style="color: #4f97d7;">(</span><span style="color: #7590db;">file</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">{</span>
        source =&gt; <span style="color: #2d9574;">"$(file)"</span>;
        missing_ok =&gt; <span style="color: #2d9574;">"true"</span>;
<span style="color: #4f97d7;">}</span>
<span style="color: #4f97d7;">body</span> <span style="color: #a45bad;">copy_from</span> <span style="color: #bc6ec5; font-weight: bold;">server_if_available</span><span style="color: #4f97d7;">(</span><span style="color: #7590db;">file</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">{</span>
        source =&gt; <span style="color: #2d9574;">"$(file)"</span>;
        missing_ok =&gt; <span style="color: #2d9574;">"true"</span>;
        servers =&gt; <span style="color: #bc6ec5;">{</span> <span style="color: #2d9574;">"127.0.0.1"</span> <span style="color: #bc6ec5;">}</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-orgcebe957">
<h4 id="orgcebe957"><code>body copy_from missing_ok</code> Example output</h4>
<pre class="example">
   error: No suitable server found
R: Classes:
copy_from_local_kept
copy_from_local_reached
copy_from_server_error
copy_from_server_failed
copy_from_server_not_kept
copy_from_server_reached

R: Yet/tmp/nickanderson-thinkpad-w550s.json doesn't exist
</pre>

</section>
<section id="slide-org6921441">
<h3 id="org6921441"><code>body control hub query_timeout</code></h3>
<ul>
<li>New in 3.12.0</li>
<li><b>Enterprise specific</b></li>

</ul>

</section>
<section id="slide-org0283792">
<h3 id="org0283792"><code>body storage mount_type</code> <code>panfs</code> &amp; <code>cifs</code></h3>
<ul>
<li>New in 3.15.0</li>
<li>Thanks SURF Sara!</li>

</ul>

</section>
<section id="slide-org4bbdad2">
<h3 id="org4bbdad2"><code>body packge_module interpreter</code></h3>
<ul>
<li>New in 3.13.0, 3.12.2</li>

</ul>
</section>
<section id="slide-orgbb0cfd7">
<h3 id="orgbb0cfd7"><code>body package_module module_path</code></h3>
<ul>
<li>New in 3.13.0, 3.12.2</li>

</ul>
</section>
<section id="slide-orge3b4f56">
<h3 id="orge3b4f56"><code>commands</code> promise <code>inform</code></h3>
<ul>
<li>New in 3.15.0</li>
<li>Useful for suppressing noise from commands that do not produce output</li>

</ul>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">commands</span>:
      <span style="color: #2d9574;">"$(paths.false)"</span>;
      <span style="color: #2d9574;">"$(paths.true)"</span> inform =&gt; <span style="color: #2d9574;">"false"</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
 info: Executing 'no timeout' ... '/bin/false'
error: Finished command related to promiser '/bin/false' -- an error occurred, returned 1
 info: Completed execution of '/bin/false'
</pre>

</section>
<section id="slide-org20ebcb6">
<h3 id="org20ebcb6"><code>files</code> promise <code>edit_template_string</code></h3>
<ul>
<li>New in 3.12.0</li>
<li>Useful for self contained policy</li>

</ul>
<div class="org-src-container">

<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>
<span style="color: #4f97d7;">{</span>
  <span style="color: #4f97d7;">files</span>:
    <span style="color: #2d9574;">"/tmp/now.txt"</span>
      create =&gt; <span style="color: #2d9574;">"true"</span>,
      edit_template_string =&gt; <span style="color: #2d9574;">"{{{sys.date}}}"</span>;
  <span style="color: #4f97d7;">reports</span>:
    <span style="color: #2d9574;">"/tmp/now.txt"</span>
      printfile =&gt; cat<span style="color: #bc6ec5;">(</span> $<span style="color: #2d9574;">(</span><span style="color: #7590db;">this.promiser</span><span style="color: #2d9574;">)</span> <span style="color: #bc6ec5;">)</span>;
<span style="color: #4f97d7;">}</span>
</pre>
</div>

<pre class="example">
    info: Created file '/tmp/now.txt', mode 0600
R: /tmp/now.txt
</pre>

</section>
<section id="slide-orge18c377">
<h3 id="orge18c377">Multiple augments</h3>
<ul>
<li>New in 3.12.0</li>

</ul>

<div class="org-src-container">

<pre  class="src src-sh">find .
</pre>
</div>

<pre class="example">
.
./def.json
./ubuntu_19.json
./example.cf
</pre>

</section>
<section id="slide-org363d806">
<h4 id="org363d806">Multiple augments: <code>def.json</code></h4>
<div class="org-src-container">
<label class="org-src-name">def.json</label>
<pre  class="src src-json"><span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">"vars"</span>: <span style="color: #bc6ec5;">{</span>
      <span style="color: #4f97d7; font-weight: bold;">"my_var"</span>: <span style="color: #2d9574;">"This is my_var, set in def.json"</span>,
      <span style="color: #4f97d7; font-weight: bold;">"my_platform_specific_var"</span>: <span style="color: #2d9574;">"This is my_platform_specific_var, set in def.json"</span>
  <span style="color: #bc6ec5;">}</span>,
    <span style="color: #4f97d7; font-weight: bold;">"augments"</span>: <span style="color: #bc6ec5;">[</span> <span style="color: #2d9574;">"$(sys.flavor).json"</span> <span style="color: #bc6ec5;">]</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-orgccc8b65">
<h4 id="orgccc8b65">Multiple augments: <code>$(sys.flavor).json</code></h4>
<div class="org-src-container">
<label class="org-src-name">ubuntu_19.json</label>
<pre  class="src src-json"><span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7; font-weight: bold;">"vars"</span>: <span style="color: #bc6ec5;">{</span>
      <span style="color: #4f97d7; font-weight: bold;">"my_platform_specific_var"</span>: <span style="color: #2d9574;">"This is my_platform_specific_var, set in ubuntu_19.json"</span>
  <span style="color: #bc6ec5;">}</span>
<span style="color: #4f97d7;">}</span>
</pre>
</div>

</section>
<section id="slide-orga60404f">
<h4 id="orga60404f">Multiple augments: policy</h4>
<div class="org-src-container">
<label class="org-src-name">example.cf</label>
<pre  class="src src-cfengine3"><span style="color: #4f97d7;">bundle</span> <span style="color: #a45bad;">agent</span> <span style="color: #bc6ec5; font-weight: bold;">main</span>
<span style="color: #4f97d7;">{</span>
    <span style="color: #4f97d7;">reports</span>:
      <span style="color: #2d9574;">"$(sys.flavor)"</span>;
      <span style="color: #2d9574;">"$(def.my_var)"</span>;
      <span style="color: #2d9574;">"$(def.my_platform_specific_var)"</span>;
<span style="color: #4f97d7;">}</span> 
</pre>
</div>

</section>
<section id="slide-orgde687a5">
<h4 id="orgde687a5">Multiple augments: Policy run and output</h4>
<div class="org-src-container">
<label class="org-src-name">Policy run and output</label>
<pre  class="src src-sh">cf-agent -KIf ./example.cf 
</pre>
</div>

<pre class="example">
R: ubuntu_19
R: This is my_var, set in def.json
R: This is my_platform_specific_var, set in ubuntu_19.json
</pre>

</section>
<section id="slide-org2982382">
<h3 id="org2982382">Augments classes by class expression</h3>
<ul>
<li>New in 3.14.0, 3.12.2</li>

</ul>
</section>
<section id="slide-org9b9653f">
<h3 id="org9b9653f">Improved CI</h3>
<ul>
<li>Valgrind</li>
<li>ASAM</li>
<li>LGTM</li>

</ul>

</section>
</section>
<section>
<section id="slide-org6474c48">
<h2 id="org6474c48">Enterprise</h2>
<ul>
<li>Federated Reporting</li>
<li>Policy Analyzer</li>
<li>Alert conditions
<ul>
<li>File changes</li>
<li>Custom SQL</li>

</ul></li>
<li>Dashboard widgets
<ul>
<li>Newly bootstrapped hosts trend</li>
<li>Decommissioned hosts trend</li>

</ul></li>
<li>Improved report builder
<ul>
<li>Extend with custom schema</li>

</ul></li>
<li>File integrity monitoring UI</li>
<li>Fine grained permissions for RBAC</li>
<li>Export/Import settings</li>
<li>APIs
<ul>
<li>Inventory</li>
<li>File changes</li>

</ul></li>
<li>New OOTB Inventory
<ul>
<li>AWS EC2 region, instance type, instance id, availability zone</li>
<li>System UUID</li>
<li>Setuid files</li>
<li>Root owned setuid files</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org67179e5">
<h2 id="org67179e5">Tooling</h2>
<dl>
<dt>cf-remote</dt><dd>Install CFEngine on remote hosts, provision vms on cloud providers</dd>
<dt>cf-check</dt><dd>Validate and repair lmdbs</dd>
<dt>cf-bottom</dt><dd>Tom, the new cfengine team member, triggers builds in jenkins</dd>
<dt>(no term)</dt><dd>::</dd>

</dl>
</section>
</section>
<section>
<section id="slide-org395df45">
<h2 id="org395df45">Thank you</h2>
<ul>
<li>Made with spacemacs, using org-mode, ob-cfengine3, and org-reveal, with love</li>

</ul>
</section>
</section>
</div>
</div>
<p> Created by Nick Anderson. </p>
<script src="file:///home/nickanderson/src/reveal.js/lib/js/head.min.js"></script>
<script src="file:///home/nickanderson/src/reveal.js/js/reveal.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: true,
keyboard: true,
mouseWheel: false,
fragmentInURL: false,
hashOneBasedIndex: false,
pdfSeparateFragments: true,

overview: true,
width: 1200,
height: 800,
margin: 0.10,
minScale: 0.50,
maxScale: 2.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'fade', // see README of reveal.js for options
transitionSpeed: 'default',

// Optional libraries used to extend reveal.js
dependencies: [
 { src: 'file:///home/nickanderson/src/reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'file:///home/nickanderson/src/reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'file:///home/nickanderson/src/reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]

});
</script>
</body>
</html>
